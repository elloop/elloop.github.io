---
layout: post
title: "【cocos2d-x 2.x 学习与应用总结】13: 借助CCGLProgram实现自定义绘制"
highlighter_style: solarizeddark
category: [cocos2d-x]
tags: [cocos2d-x, game]
description: ""
published: true
---

#前言

本文总结了如何借助CCGLProgram来实现自定义绘制的节点类，使用自定义的顶点着色器和片段着色器，实现一个绘制彩色矩形的节点类。

绘制的效果图如下所示：

![custom_draw_rectangle.jpg](http://7xi3zl.com1.z0.glb.clouddn.com/custom_draw_rectangle.jpg)

<!--more-->

# 实现

## 1. 自定义节点类CustomDrawNode继承自CCNode

CustomDrawNode作为一个自定义绘制节点类的父类的角色，具体的自定义绘制类继承CustomDrawNode

CustomDrawNode的创建通过指定一对着色器文件名，内部使用CCGLProgram来创建着色器程序

CustomDrawNode预留模板方法接口，让具体的子类来控制着色器程序的变量绑定及传值

CustomDrawNode重写CCNode的draw方法以实现自定义绘制，其子类需要重写draw方法以实现绘制

## 2. 矩形类CustomRectangleNode继承CustomDrawNode

CustomRectangleNode继承CustomDrawNode并重写着色器变量绑定和draw方法实现矩形的绘制。

## 3. 顶点着色器

```c++
#ifdef GL_ES
precision mediump float;
#endif

attribute   vec4    custom_a_position;
uniform     vec4    custom_u_color;

varying     vec4    custom_v_color;

void main()
{
    gl_Position = CC_MVPMatrix * custom_a_position;
    custom_v_color = custom_u_color;
}
```

## 4. 片段着色器


```c++
#ifdef GL_ES
precision mediump float;
#endif

varying     vec4    custom_v_color;

void main()
{
    gl_FragColor = custom_v_color;
}
```

# 源码

---------------------------

**作者水平有限，对相关知识的理解和总结难免有错误，还望给予指正，非常感谢！**

**在这里也能看到这篇文章：[github博客](http://elloop.github.io), [CSDN博客](http://blog.csdn.net/elloop), 欢迎访问**

