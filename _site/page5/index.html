
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Small Flows</title>
    
    <meta name="author" content="elloop">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap styles -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional theme --><!-- 
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet"> -->
    <!-- Optional theme --><!-- 
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap-solarized-dark.css" rel="stylesheet"> -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/colors-dark.css" rel="stylesheet">
    <!-- highlighting css -->
    
        <link href="/assets/syntaxcss/solarizeddark.css" rel="stylesheet" type="text/css" media="all">
    

    
    <!-- Custom styles -->
    <link href="/assets/themes/bootstrap-3/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!-- Update these with your own images -->
      <link rel="shortcut icon" href="/assets/themes/bootstrap-3/favicon.png">
      <!-- <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png"> -->
   

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

</head>

<body>

    
<style type="text/css">
</style>

<div id="wrap">
    <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Small Flows</a>
            <!-- 
            <a href="http://github.com/elloop"><img class="navbar-brand" src="/assets/images/github-icon.png" alt="Star me on GitHub" /></a>
            -->
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
            <ul class="nav navbar-nav">
                  


  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">归档</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">分类</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">标签</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  




            </ul>
            <!--

                <a href="http://github.com/elloop"><img class="naviconhref" src="/assets/images/github-icon.png" alt="Star me on GitHub" /></a>

            <form action="http://www.google.com/search" class="navbar-form navbar-right" method="get">
                <div class="form-group">
                    <input class="form-control" placeholder="Google" name="q" size="31" maxlength="255" value="" type="text">
                </div>
                <input value="Search" class="btn btn-default" type="submit">
                <input style="display:none" value="http://elloop.github.io" name="sitesearch" checked="" type="radio">
            </form>
            -->
        </div>
        <!-- /.navbar-collapse -->

    </nav>

    <div class="container">
        
<div class="page-header">
  <h1>Small Flows  <br><small>不积跬步无以至千里，不积小流无以成江海</small></h1>
</div>

<div class="row">
  <div class="col-xs-12">
    

<h2 id="sample-posts">Posts</h2>

<!--
<ul class="posts">
   
    <li><span>29 Jun 2015</span> &raquo; <a href="/life/2015-06-29/working-4-hours-perday">working 4 hours everyday</a></li>
    
    <p style="background: color"><p>每个人都熟悉这种作息规律：早上9点去上班，坐在电脑前面，编一天的程序，下午5点下班回家。如今，非常感谢蒂莫西·费里斯 (Timothy Ferriss)的《每周工作4小时》，我开始重新思考应该如何工作，如何让自己变成更有效率的程序员。</p>

<p>最近，我把我的从周一到周五的作息规律做了一次较大的调整。很长时间以来，我一直像所有其他程序员那样工作、休息。但就在2011年的下半年，我开 始了一项试验，想看看究竟什么样的作息时间能让我更有效率。这项实验目前仍在进行中，我并不是像军人那样严格遵守实验规定——例如，我也想会早20分钟、 或晚20分钟起床——但当前制定的作息规律是这样的：</p>

<p>早上4：30 到 7 点：冥想，写作，目标复查，和家人吃早餐</p>
</p>
   
    <li><span>18 Mar 2015</span> &raquo; <a href="/windows/2015-03-18/windows_skills">windows skills</a></li>
    
    <p style="background: color"><h2>1. the system</h2>

<ul>
<li><p>how long the system has run?
cmd&gt;systeminfo </p></li>
<li><p>remote connect
win+r : mstsc</p></li>
<li><p>Turn on Telnet
控制面板 -》程序和功能 -》开启或关闭windows功能 -》telnet客户端</p></li>
</ul>
</p>
   
    <li><span>18 Mar 2015</span> &raquo; <a href="/programming/2015-03-18/url_spelling">Url Spelling Rules</a></li>
    
    <p style="background: color"><h2>ampersand</h2>

<p><code>http://images.google.com/images?num=30&amp;q=larry+bird</code>
you need to encode the URL as:
<code>http://images.google.com/images?num=30&amp;amp;q=larry+bird</code></p>
</p>
   
    <li><span>18 Mar 2015</span> &raquo; <a href="/c++/2015-03-18/c_programming_style_of_linux_kernal">Linux kernel coding style</a></li>
    
    <p style="background: color"><p>Annotation from Chris Lott:</p>

<p>This is file &#39;CodingStyle&#39; from the Linux kernel source area.</p>

<p>Of course the author is Linus Torvalds.</p>

<p>To get the most recent version of this document, see:
<a href="http://vger.samba.org/cgi-bin/cvsweb/linux/Documentation/CodingStyle?cvsroot=vger">http://vger.samba.org/cgi-bin/cvsweb/linux/Documentation/CodingStyle?cvsroot=vger</a></p>

<hr>

<p>Linux kernel coding style </p>

<p>This is a short document describing the preferred coding style for the
linux kernel.  Coding style is very personal, and I won&#39;t <em>force</em> my
views on anybody, but this is what goes for anything that I have to be
able to maintain, and I&#39;d prefer it for most other things too.  Please
at least consider the points made here. </p>

<p>First off, I&#39;d suggest printing out a copy of the GNU coding standards,
and NOT read it.  Burn them, it&#39;s a great symbolic gesture. </p>

<p>Anyway, here goes:</p>

<p>Chapter 1: Indentation</p>

<p>Tabs are 8 characters, and thus indentations are also 8 characters. 
There are heretic movements that try to make indentations 4 (or even 2!)
characters deep, and that is akin to trying to define the value of PI to
be 3. </p>

<p>Rationale: The whole idea behind indentation is to clearly define where
a block of control starts and ends.  Especially when you&#39;ve been looking
at your screen for 20 straight hours, you&#39;ll find it a lot easier to see
how the indentation works if you have large indentations. </p>

<p>Now, some people will claim that having 8-character indentations makes
the code move too far to the right, and makes it hard to read on a
80-character terminal screen.  The answer to that is that if you need
more than 3 levels of indentation, you&#39;re screwed anyway, and should fix
your program. </p>

<p>In short, 8-char indents make things easier to read, and have the added
benefit of warning you when you&#39;re nesting your functions too deep. 
Heed that warning. </p>

<p>Chapter 2: Placing Braces</p>

<p>The other issue that always comes up in C styling is the placement of
braces.  Unlike the indent size, there are few technical reasons to
choose one placement strategy over the other, but the preferred way, as
shown to us by the prophets Kernighan and Ritchie, is to put the opening
brace last on the line, and put the closing brace first, thusly:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    if (x is true) {
        we do y
    }
</code></pre></div>
<p>However, there is one special case, namely functions: they have the
opening brace at the beginning of the next line, thus:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    int function(int x)
    {
        body of function
    }
</code></pre></div>
<p>Heretic people all over the world have claimed that this inconsistency
is ...  well ...  inconsistent, but all right-thinking people know that
(a) K&amp;R are <em>right</em> and (b) K&amp;R are right.  Besides, functions are
special anyway (you can&#39;t nest them in C). </p>

<p>Note that the closing brace is empty on a line of its own, <em>except</em> in
the cases where it is followed by a continuation of the same statement,
ie a &quot;while&quot; in a do-statement or an &quot;else&quot; in an if-statement, like
this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    do {
        body of do-loop
    } while (condition);
</code></pre></div>
<p>and</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    if (x == y) {
        ..
    } else if (x &gt; y) {
        ...
    } else {
        ....
    }
</code></pre></div>
<p>Rationale: K&amp;R. </p>

<p>Also, note that this brace-placement also minimizes the number of empty
(or almost empty) lines, without any loss of readability.  Thus, as the
supply of new-lines on your screen is not a renewable resource (think
25-line terminal screens here), you have more empty lines to put
comments on. </p>

<p>Chapter 3: Naming</p>

<p>C is a Spartan language, and so should your naming be.  Unlike Modula-2
and Pascal programmers, C programmers do not use cute names like
ThisVariableIsATemporaryCounter.  A C programmer would call that
variable &quot;tmp&quot;, which is much easier to write, and not the least more
difficult to understand. </p>

<p>HOWEVER, while mixed-case names are frowned upon, descriptive names for
global variables are a must.  To call a global function &quot;foo&quot; is a
shooting offense. </p>

<p>GLOBAL variables (to be used only if you <em>really</em> need them) need to
have descriptive names, as do global functions.  If you have a function
that counts the number of active users, you should call that
&quot;count_active_users()&quot; or similar, you should <em>not</em> call it &quot;cntusr()&quot;. </p>

<p>Encoding the type of a function into the name (so-called Hungarian
notation) is brain damaged - the compiler knows the types anyway and can
check those, and it only confuses the programmer.  No wonder MicroSoft
makes buggy programs. </p>

<p>LOCAL variable names should be short, and to the point.  If you have
some random integer loop counter, it should probably be called &quot;i&quot;. 
Calling it &quot;loop_counter&quot; is non-productive, if there is no chance of it
being mis-understood.  Similarly, &quot;tmp&quot; can be just about any type of
variable that is used to hold a temporary value. </p>

<p>If you are afraid to mix up your local variable names, you have another
problem, which is called the function-growth-hormone-imbalance syndrome. 
See next chapter. </p>

<p>Chapter 4: Functions</p>

<p>Functions should be short and sweet, and do just one thing.  They should
fit on one or two screenfuls of text (the ISO/ANSI screen size is 80x24,
as we all know), and do one thing and do that well. </p>

<p>The maximum length of a function is inversely proportional to the
complexity and indentation level of that function.  So, if you have a
conceptually simple function that is just one long (but simple)
case-statement, where you have to do lots of small things for a lot of
different cases, it&#39;s OK to have a longer function. </p>

<p>However, if you have a complex function, and you suspect that a
less-than-gifted first-year high-school student might not even
understand what the function is all about, you should adhere to the
maximum limits all the more closely.  Use helper functions with
descriptive names (you can ask the compiler to in-line them if you think
it&#39;s performance-critical, and it will probably do a better job of it
that you would have done). </p>

<p>Another measure of the function is the number of local variables.  They
shouldn&#39;t exceed 5-10, or you&#39;re doing something wrong.  Re-think the
function, and split it into smaller pieces.  A human brain can
generally easily keep track of about 7 different things, anything more
and it gets confused.  You know you&#39;re brilliant, but maybe you&#39;d like
to understand what you did 2 weeks from now. </p>

<p>Chapter 5: Commenting</p>

<p>Comments are good, but there is also a danger of over-commenting.  NEVER
try to explain HOW your code works in a comment: it&#39;s much better to
write the code so that the <em>working</em> is obvious, and it&#39;s a waste of
time to explain badly written code. </p>

<p>Generally, you want your comments to tell WHAT your code does, not HOW. 
Also, try to avoid putting comments inside a function body: if the
function is so complex that you need to separately comment parts of it,
you should probably go back to chapter 4 for a while.  You can make
small comments to note or warn about something particularly clever (or
ugly), but try to avoid excess.  Instead, put the comments at the head
of the function, telling people what it does, and possibly WHY it does
it. </p>

<p>Chapter 6: You&#39;ve made a mess of it</p>

<p>That&#39;s OK, we all do.  You&#39;ve probably been told by your long-time Unix
user helper that &quot;GNU emacs&quot; automatically formats the C sources for
you, and you&#39;ve noticed that yes, it does do that, but the defaults it
uses are less than desirable (in fact, they are worse than random
typing - a infinite number of monkeys typing into GNU emacs would never
make a good program). </p>

<p>So, you can either get rid of GNU emacs, or change it to use saner
values.  To do the latter, you can stick the following in your .emacs file:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">(defun linux-c-mode ()
  &quot;C mode with adjusted defaults for use with the Linux kernel.&quot;
  (interactive)
  (c-mode)
  (c-set-style &quot;K&amp;R&quot;)
  (setq c-basic-offset 8))
</code></pre></div>
<p>This will define the M-x linux-c-mode command.  When hacking on a
module, if you put the string -<em>- linux-c -</em>- somewhere on the first
two lines, this mode will be automatically invoked. Also, you may want
to add</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">(setq auto-mode-alist (cons &#39;(&quot;/usr/src/linux.*/.*\\.[ch]$&quot; . linux-c-mode)
                       auto-mode-alist))
</code></pre></div>
<p>to your .emacs file if you want to have linux-c-mode switched on
automagically when you edit source files under /usr/src/linux.</p>

<p>But even if you fail in getting emacs to do sane formatting, not
everything is lost: use &quot;indent&quot;.</p>

<p>Now, again, GNU indent has the same brain dead settings that GNU emacs
has, which is why you need to give it a few command line options. 
However, that&#39;s not too bad, because even the makers of GNU indent
recognize the authority of K&amp;R (the GNU people aren&#39;t evil, they are
just severely misguided in this matter), so you just give indent the
options &quot;-kr -i8&quot; (stands for &quot;K&amp;R, 8 character indents&quot;). </p>

<p>&quot;indent&quot; has a lot of options, and especially when it comes to comment
re-formatting you may want to take a look at the manual page.  But
remember: &quot;indent&quot; is not a fix for bad programming. </p>

<p>Chapter 7: Configuration-files</p>

<p>For configuration options (arch/xxx/config.in, and all the Config.in files),
somewhat different indentation is used.</p>

<p>An indention level of 3 is used in the code, while the text in the config-
options should have an indention-level of 2 to indicate dependencies. The
latter only applies to bool/tristate options. For other options, just use
common sense. An example:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">if [ &quot;$CONFIG_EXPERIMENTAL&quot; = &quot;y&quot; ]; then
   tristate &#39;Apply nitroglycerine inside the keyboard (DANGEROUS)&#39; CONFIG_BOOM
   if [ &quot;$CONFIG_BOOM&quot; != &quot;n&quot; ]; then
      bool &#39;  Output nice messages when you explode&#39; CONFIG_CHEER
   fi
fi
</code></pre></div>
<p>Generally, CONFIG_EXPERIMENTAL should surround all options not considered
stable. All options that are known to trash data (experimental write-
support for file-systems, for instance) should be denoted (DANGEROUS), other
Experimental options should be denoted (EXPERIMENTAL).</p>

<p>Chapter 8: Data structures</p>

<p>Data structures that have visibility outside the single-threaded
environment they are created and destroyed in should always have
reference counts.  In the kernel, garbage collection doesn&#39;t exist (and
outside the kernel garbage collection is slow and inefficient), which
means that you absolutely <em>have</em> to reference count all your uses. </p>

<p>Reference counting means that you can avoid locking, and allows multiple
users to have access to the data structure in parallel - and not having
to worry about the structure suddenly going away from under them just
because they slept or did something else for a while. </p>

<p>Note that locking is <em>not</em> a replacement for reference counting. 
Locking is used to keep data structures coherent, while reference
counting is a memory management technique.  Usually both are needed, and
they are not to be confused with each other.</p>

<p>Many data structures can indeed have two levels of reference counting,
when there are users of different &quot;classes&quot;.  The subclass count counts
the number of subclass users, and decrements the global count just once
when the subclass count goes to zero.</p>

<p>Examples of this kind of &quot;multi-reference-counting&quot; can be found in
memory management (&quot;struct mm_struct&quot;: mm_users and mm_count), and in
filesystem code (&quot;struct super_block&quot;: s_count and s_active).</p>

<p>Remember: if another thread can find your data structure, and you don&#39;t
have a reference count on it, you almost certainly have a bug.</p>
</p>
   
    <li><span>15 Mar 2015</span> &raquo; <a href="/life/2015-03-15/word-learning">English Words Learning</a></li>
    
    <p style="background: color"><p>Words copied from <code>Merriam-Webster.com</code></p>

<p>word            meanings
omni</p>

<blockquote>
<p>: all : in all ways, places, etc. : without limits.  all, universally.</p>
</blockquote>
</p>
  
</ul>
-->



<!-- <div class="hero-unit"> -->
  <div class="posts">
    <p>
    	<h2>
    		<a href="/life/2015-06-29/working-4-hours-perday">working 4 hours everyday</a>
    	</h2>
        <!-- Monday 29 June 2015 -->
        29 Jun 2015
        <!-- { post.content | strip_html | truncatewords: 35 }}-->
        <p>每个人都熟悉这种作息规律：早上9点去上班，坐在电脑前面，编一天的程序，下午5点下班回家。如今，非常感谢蒂莫西·费里斯 (Timothy Ferriss)的《每周工作4小时》，我开始重新思考应该如何工作，如何让自己变成更有效率的程序员。

最近，我把我的从周一到周五的作息规律做了一次较大的调整。很长时间以来，我一直像所有其他程序员那样工作、休息。但就在2011年的下半年，我开 始了一项试验，想看看究竟什么样的作息时间能让我更有效率。这项实验目前仍在进行中，我并不是像军人那样严格遵守实验规定——例如，我也想会早20分钟、 或晚20分钟起床——但当前制定的作息规律是这样的：

早上4：30 到 7 点：冥想，写作，目标复查，和家人吃早餐
...</p>
    	<p><a href="/life/2015-06-29/working-4-hours-perday">阅读全文 ...</a></p> 
    </p>
    <hr/>
  </div>

<!-- <div class="hero-unit"> -->
  <div class="posts">
    <p>
    	<h2>
    		<a href="/windows/2015-03-18/windows_skills">windows skills</a>
    	</h2>
        <!-- Wednesday 18 March 2015 -->
        18 Mar 2015
        <!-- { post.content | strip_html | truncatewords: 35 }}-->
        <p><h2>1. the system</h2>

<ul>
<li>how long the system has run?
cmd&gt;systeminfo </li>
<li>remote connect
win+r : mstsc</li>
<li>Turn on Telnet
控制面板 -》程序和功能 -》开启或关闭windows功能 -》telnet客户端</li>
</ul>
...</p>
    	<p><a href="/windows/2015-03-18/windows_skills">阅读全文 ...</a></p> 
    </p>
    <hr/>
  </div>

<!-- <div class="hero-unit"> -->
  <div class="posts">
    <p>
    	<h2>
    		<a href="/programming/2015-03-18/url_spelling">Url Spelling Rules</a>
    	</h2>
        <!-- Wednesday 18 March 2015 -->
        18 Mar 2015
        <!-- { post.content | strip_html | truncatewords: 35 }}-->
        <p><h2>ampersand</h2>

<code>http://images.google.com/images?num=30&amp;q=larry+bird</code>
you need to encode the URL as:
<code>http://images.google.com/images?num=30&amp;amp;q=larry+bird</code>
...</p>
    	<p><a href="/programming/2015-03-18/url_spelling">阅读全文 ...</a></p> 
    </p>
    <hr/>
  </div>

<!-- <div class="hero-unit"> -->
  <div class="posts">
    <p>
    	<h2>
    		<a href="/c++/2015-03-18/c_programming_style_of_linux_kernal">Linux kernel coding style</a>
    	</h2>
        <!-- Wednesday 18 March 2015 -->
        18 Mar 2015
        <!-- { post.content | strip_html | truncatewords: 35 }}-->
        <p>Annotation from Chris Lott:

This is file &#39;CodingStyle&#39; from the Linux kernel source area.

Of course the author is Linus Torvalds.

To get the most recent version of this document, see:
<a href="http://vger.samba.org/cgi-bin/cvsweb/linux/Documentation/CodingStyle?cvsroot=vger">http://vger.samba.org/cgi-bin/cvsweb/linux/Documentation/CodingStyle?cvsroot=vger</a>

<hr>

Linux kernel coding style 

This is a short document describing the preferred coding style for the
linux kernel.  Coding style is very personal, and I won&#39;t <em>force</em> my
views on anybody, but this is what goes for anything that I have to be
able to maintain, and I&#39;d prefer it for most other things too.  Please
at least consider the points made here. 

First off, I&#39;d suggest printing out a copy of the GNU coding standards,
and NOT read it.  Burn them, it&#39;s a great symbolic gesture. 

Anyway, here goes:

Chapter 1: Indentation

Tabs are 8 characters, and thus indentations are also 8 characters. 
There are heretic movements that try to make indentations 4 (or even 2!)
characters deep, and that is akin to trying to define the value of PI to
be 3. 

Rationale: The whole idea behind indentation is to clearly define where
a block of control starts and ends.  Especially when you&#39;ve been looking
at your screen for 20 straight hours, you&#39;ll find it a lot easier to see
how the indentation works if you have large indentations. 

Now, some people will claim that having 8-character indentations makes
the code move too far to the right, and makes it hard to read on a
80-character terminal screen.  The answer to that is that if you need
more than 3 levels of indentation, you&#39;re screwed anyway, and should fix
your program. 

In short, 8-char indents make things easier to read, and have the added
benefit of warning you when you&#39;re nesting your functions too deep. 
Heed that warning. 

Chapter 2: Placing Braces

The other issue that always comes up in C styling is the placement of
braces.  Unlike the indent size, there are few technical reasons to
choose one placement strategy over the other, but the preferred way, as
shown to us by the prophets Kernighan and Ritchie, is to put the opening
brace last on the line, and put the closing brace first, thusly:
<div class="highlight"><pre><code class="language-text" data-lang="text">    if (x is true) {
        we do y
    }
</code></pre></div>
However, there is one special case, namely functions: they have the
opening brace at the beginning of the next line, thus:
<div class="highlight"><pre><code class="language-text" data-lang="text">    int function(int x)
    {
        body of function
    }
</code></pre></div>
Heretic people all over the world have claimed that this inconsistency
is ...  well ...  inconsistent, but all right-thinking people know that
(a) K&amp;R are <em>right</em> and (b) K&amp;R are right.  Besides, functions are
special anyway (you can&#39;t nest them in C). 

Note that the closing brace is empty on a line of its own, <em>except</em> in
the cases where it is followed by a continuation of the same statement,
ie a &quot;while&quot; in a do-statement or an &quot;else&quot; in an if-statement, like
this:
<div class="highlight"><pre><code class="language-text" data-lang="text">    do {
        body of do-loop
    } while (condition);
</code></pre></div>
and
<div class="highlight"><pre><code class="language-text" data-lang="text">    if (x == y) {
        ..
    } else if (x &gt; y) {
        ...
    } else {
        ....
    }
</code></pre></div>
Rationale: K&amp;R. 

Also, note that this brace-placement also minimizes the number of empty
(or almost empty) lines, without any loss of readability.  Thus, as the
supply of new-lines on your screen is not a renewable resource (think
25-line terminal screens here), you have more empty lines to put
comments on. 

Chapter 3: Naming

C is a Spartan language, and so should your naming be.  Unlike Modula-2
and Pascal programmers, C programmers do not use cute names like
ThisVariableIsATemporaryCounter.  A C programmer would call that
variable &quot;tmp&quot;, which is much easier to write, and not the least more
difficult to understand. 

HOWEVER, while mixed-case names are frowned upon, descriptive names for
global variables are a must.  To call a global function &quot;foo&quot; is a
shooting offense. 

GLOBAL variables (to be used only if you <em>really</em> need them) need to
have descriptive names, as do global functions.  If you have a function
that counts the number of active users, you should call that
&quot;count_active_users()&quot; or similar, you should <em>not</em> call it &quot;cntusr()&quot;. 

Encoding the type of a function into the name (so-called Hungarian
notation) is brain damaged - the compiler knows the types anyway and can
check those, and it only confuses the programmer.  No wonder MicroSoft
makes buggy programs. 

LOCAL variable names should be short, and to the point.  If you have
some random integer loop counter, it should probably be called &quot;i&quot;. 
Calling it &quot;loop_counter&quot; is non-productive, if there is no chance of it
being mis-understood.  Similarly, &quot;tmp&quot; can be just about any type of
variable that is used to hold a temporary value. 

If you are afraid to mix up your local variable names, you have another
problem, which is called the function-growth-hormone-imbalance syndrome. 
See next chapter. 

Chapter 4: Functions

Functions should be short and sweet, and do just one thing.  They should
fit on one or two screenfuls of text (the ISO/ANSI screen size is 80x24,
as we all know), and do one thing and do that well. 

The maximum length of a function is inversely proportional to the
complexity and indentation level of that function.  So, if you have a
conceptually simple function that is just one long (but simple)
case-statement, where you have to do lots of small things for a lot of
different cases, it&#39;s OK to have a longer function. 

However, if you have a complex function, and you suspect that a
less-than-gifted first-year high-school student might not even
understand what the function is all about, you should adhere to the
maximum limits all the more closely.  Use helper functions with
descriptive names (you can ask the compiler to in-line them if you think
it&#39;s performance-critical, and it will probably do a better job of it
that you would have done). 

Another measure of the function is the number of local variables.  They
shouldn&#39;t exceed 5-10, or you&#39;re doing something wrong.  Re-think the
function, and split it into smaller pieces.  A human brain can
generally easily keep track of about 7 different things, anything more
and it gets confused.  You know you&#39;re brilliant, but maybe you&#39;d like
to understand what you did 2 weeks from now. 

Chapter 5: Commenting

Comments are good, but there is also a danger of over-commenting.  NEVER
try to explain HOW your code works in a comment: it&#39;s much better to
write the code so that the <em>working</em> is obvious, and it&#39;s a waste of
time to explain badly written code. 

Generally, you want your comments to tell WHAT your code does, not HOW. 
Also, try to avoid putting comments inside a function body: if the
function is so complex that you need to separately comment parts of it,
you should probably go back to chapter 4 for a while.  You can make
small comments to note or warn about something particularly clever (or
ugly), but try to avoid excess.  Instead, put the comments at the head
of the function, telling people what it does, and possibly WHY it does
it. 

Chapter 6: You&#39;ve made a mess of it

That&#39;s OK, we all do.  You&#39;ve probably been told by your long-time Unix
user helper that &quot;GNU emacs&quot; automatically formats the C sources for
you, and you&#39;ve noticed that yes, it does do that, but the defaults it
uses are less than desirable (in fact, they are worse than random
typing - a infinite number of monkeys typing into GNU emacs would never
make a good program). 

So, you can either get rid of GNU emacs, or change it to use saner
values.  To do the latter, you can stick the following in your .emacs file:
<div class="highlight"><pre><code class="language-text" data-lang="text">(defun linux-c-mode ()
  &quot;C mode with adjusted defaults for use with the Linux kernel.&quot;
  (interactive)
  (c-mode)
  (c-set-style &quot;K&amp;R&quot;)
  (setq c-basic-offset 8))
</code></pre></div>
This will define the M-x linux-c-mode command.  When hacking on a
module, if you put the string -<em>- linux-c -</em>- somewhere on the first
two lines, this mode will be automatically invoked. Also, you may want
to add
<div class="highlight"><pre><code class="language-text" data-lang="text">(setq auto-mode-alist (cons &#39;(&quot;/usr/src/linux.*/.*\\.[ch]$&quot; . linux-c-mode)
                       auto-mode-alist))
</code></pre></div>
to your .emacs file if you want to have linux-c-mode switched on
automagically when you edit source files under /usr/src/linux.

But even if you fail in getting emacs to do sane formatting, not
everything is lost: use &quot;indent&quot;.

Now, again, GNU indent has the same brain dead settings that GNU emacs
has, which is why you need to give it a few command line options. 
However, that&#39;s not too bad, because even the makers of GNU indent
recognize the authority of K&amp;R (the GNU people aren&#39;t evil, they are
just severely misguided in this matter), so you just give indent the
options &quot;-kr -i8&quot; (stands for &quot;K&amp;R, 8 character indents&quot;). 

&quot;indent&quot; has a lot of options, and especially when it comes to comment
re-formatting you may want to take a look at the manual page.  But
remember: &quot;indent&quot; is not a fix for bad programming. 

Chapter 7: Configuration-files

For configuration options (arch/xxx/config.in, and all the Config.in files),
somewhat different indentation is used.

An indention level of 3 is used in the code, while the text in the config-
options should have an indention-level of 2 to indicate dependencies. The
latter only applies to bool/tristate options. For other options, just use
common sense. An example:
<div class="highlight"><pre><code class="language-text" data-lang="text">if [ &quot;$CONFIG_EXPERIMENTAL&quot; = &quot;y&quot; ]; then
   tristate &#39;Apply nitroglycerine inside the keyboard (DANGEROUS)&#39; CONFIG_BOOM
   if [ &quot;$CONFIG_BOOM&quot; != &quot;n&quot; ]; then
      bool &#39;  Output nice messages when you explode&#39; CONFIG_CHEER
   fi
fi
</code></pre></div>
Generally, CONFIG_EXPERIMENTAL should surround all options not considered
stable. All options that are known to trash data (experimental write-
support for file-systems, for instance) should be denoted (DANGEROUS), other
Experimental options should be denoted (EXPERIMENTAL).

Chapter 8: Data structures

Data structures that have visibility outside the single-threaded
environment they are created and destroyed in should always have
reference counts.  In the kernel, garbage collection doesn&#39;t exist (and
outside the kernel garbage collection is slow and inefficient), which
means that you absolutely <em>have</em> to reference count all your uses. 

Reference counting means that you can avoid locking, and allows multiple
users to have access to the data structure in parallel - and not having
to worry about the structure suddenly going away from under them just
because they slept or did something else for a while. 

Note that locking is <em>not</em> a replacement for reference counting. 
Locking is used to keep data structures coherent, while reference
counting is a memory management technique.  Usually both are needed, and
they are not to be confused with each other.

Many data structures can indeed have two levels of reference counting,
when there are users of different &quot;classes&quot;.  The subclass count counts
the number of subclass users, and decrements the global count just once
when the subclass count goes to zero.

Examples of this kind of &quot;multi-reference-counting&quot; can be found in
memory management (&quot;struct mm_struct&quot;: mm_users and mm_count), and in
filesystem code (&quot;struct super_block&quot;: s_count and s_active).

Remember: if another thread can find your data structure, and you don&#39;t
have a reference count on it, you almost certainly have a bug.
...</p>
    	<p><a href="/c++/2015-03-18/c_programming_style_of_linux_kernal">阅读全文 ...</a></p> 
    </p>
    <hr/>
  </div>

<!-- <div class="hero-unit"> -->
  <div class="posts">
    <p>
    	<h2>
    		<a href="/life/2015-03-15/word-learning">English Words Learning</a>
    	</h2>
        <!-- Sunday 15 March 2015 -->
        15 Mar 2015
        <!-- { post.content | strip_html | truncatewords: 35 }}-->
        <p>Words copied from <code>Merriam-Webster.com</code>

word            meanings
omni

<blockquote>
: all : in all ways, places, etc. : without limits.  all, universally.
</blockquote>
...</p>
    	<p><a href="/life/2015-03-15/word-learning">阅读全文 ...</a></p> 
    </p>
    <hr/>
  </div>




<ul class="pagination">
  
    <li><a href="/page4">&laquo; Prev</a></li>
  

  
    
      <li><a href="/index.html">1</a></li>
    
  
    
      <li><a href="/page2">2</a></li>
    
  
    
      <li><a href="/page3">3</a></li>
    
  
    
      <li><a href="/page4">4</a></li>
    
  
    
      <li class="active"><span>5</span></li>
    
  
    
      <li><a href="/page6">6</a></li>
    
  
    
      <li><a href="/page7">7</a></li>
    
  
    
      <li><a href="/page8">8</a></li>
    
  
    
      <li><a href="/page9">9</a></li>
    
  
    
      <li><a href="/page10">10</a></li>
    
  
    
      <li><a href="/page11">11</a></li>
    
  
    
      <li><a href="/page12">12</a></li>
    
  
    
      <li><a href="/page13">13</a></li>
    
  
    
      <li><a href="/page14">14</a></li>
    
  
    
      <li><a href="/page15">15</a></li>
    
  

  
    <li><a href="/page6">Next &raquo;</a></li>
  
</ul>



  </div>
</div>


    </div>

<nav class="footer">
    <div class="container">
        <span class="copyright">
            Content by <a href="https://github.com/elloop">elloop</a> (<a rel="licence" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Some rights reserved</a>)			
        </span>
        <p>
        </p>
    </div>
</nav>

</div>





    

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-64459285-1', 'auto');
      ga('send', 'pageview');

    </script>


    <!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="/assets/themes/bootstrap-3/bootstrap/js/bootstrap.min.js"></script>
    
</body>

</html>
